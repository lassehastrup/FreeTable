# ğŸª‘ FreeTable

A web application that displays office desk/table availability based on Exchange Online calendar data. If a user is marked as **Out of Office** in their calendar, their assigned table is shown as **Available**.

## Features

- ğŸ“Š **Floor Plan View** - Visual representation of office layout with color-coded desk status
- ğŸ“‹ **Grid View** - Card-based list of all desks with availability details
- ğŸ¢ **Multi-Location Support** - Manage multiple office locations
- ğŸ”„ **Calendar Integration** - Fetches Out of Office status from Exchange Online via Microsoft Graph
- ğŸ¨ **Modern UI** - Clean, responsive design built with React + TypeScript

## Project Structure

```
FreeTable/
â”œâ”€â”€ client/                 # TypeScript React frontend
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ data/          # JSON data files (generated by PowerShell)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/    # Reusable UI components
â”‚       â”œâ”€â”€ pages/         # Page components
â”‚       â”œâ”€â”€ services/      # API services
â”‚       â””â”€â”€ types/         # TypeScript types
â”œâ”€â”€ scripts/               # PowerShell scripts for data fetching
â”‚   â”œâ”€â”€ Get-TableAvailability.ps1
â”‚   â””â”€â”€ Update-Availability.ps1
â””â”€â”€ locations/             # Location configuration files
    â”œâ”€â”€ aarhus/
    â”‚   â””â”€â”€ config.json
    â””â”€â”€ skanderborg/
        â””â”€â”€ config.json
```

## Prerequisites

- **Node.js** 18+ and npm
- **PowerShell** 7+ (cross-platform)
- **Microsoft.Graph** PowerShell module
- Access to **Microsoft 365 / Exchange Online**

## Setup

### 1. Install Dependencies

```bash
# Install client dependencies
npm run install:all
```

### 2. Install Microsoft Graph PowerShell Module

```powershell
Install-Module Microsoft.Graph -Scope CurrentUser
```

### 3. Configure Locations

Edit the configuration files in `locations/` to match your office setup:

```json
// locations/aarhus/config.json
{
  "id": "aarhus",
  "name": "Aarhus Office",
  "floorPlan": { "width": 400, "height": 250 },
  "tables": [
    {
      "id": "A1",
      "name": "Table A1",
      "assignedUser": "john.doe@yourdomain.com",
      "position": { "x": 50, "y": 50, "width": 80, "height": 60 }
    }
  ]
}
```

### 4. Fetch Availability Data

```powershell
cd scripts
pwsh ./Get-TableAvailability.ps1
```

This will:
- Connect to Microsoft Graph (interactive login on first run)
- Check each user's calendar for Out of Office status
- Generate JSON files in `client/public/data/`

### 5. Run the Application

```bash
npm run dev
```

Open http://localhost:3000 in your browser.

## Updating Availability

### Manual Update

```powershell
npm run update-availability
```

### Continuous Updates

```powershell
cd scripts
pwsh ./Update-Availability.ps1 -Interval 5  # Updates every 5 minutes
```

### Scheduled Task (Windows)

```powershell
# Create a scheduled task to run every 5 minutes
$action = New-ScheduledTaskAction -Execute "pwsh.exe" `
  -Argument "-File C:\path\to\FreeTable\scripts\Get-TableAvailability.ps1"
$trigger = New-ScheduledTaskTrigger -Once -At (Get-Date) `
  -RepetitionInterval (New-TimeSpan -Minutes 5)
Register-ScheduledTask -TaskName "FreeTable Update" -Action $action -Trigger $trigger
```

## How It Works

1. **Location Config** â†’ Each office has a `config.json` defining tables and assigned users
2. **PowerShell Script** â†’ Connects to Microsoft Graph and checks each user's calendar
3. **Out of Office Detection** â†’ Looks for:
   - Events with `showAs = "oof"` (Out of Office)
   - Events with subjects containing: "out of office", "vacation", "holiday", "pto", "ferie"
4. **JSON Output** â†’ Generates availability data for the frontend
5. **React Frontend** â†’ Displays real-time desk availability

## Availability Logic

| User Status | Table Status |
|------------|--------------|
| No assigned user | âœ… Available |
| User is Out of Office | âœ… Available |
| User has OOO calendar event | âœ… Available |
| User is in office | âŒ Occupied |
| Cannot fetch calendar | âš ï¸ Unknown |

## Microsoft Graph Permissions

The PowerShell script requires these permissions (granted via interactive consent):

- `Calendars.Read` - Read calendar events
- `User.Read.All` - Read user information

## Development

```bash
# Start development server with hot reload
npm run dev

# Build for production
npm run build

# Lint code
cd client && npm run lint
```

## License

MIT
